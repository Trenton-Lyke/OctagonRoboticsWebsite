<!DOCTYPE html>
<!--Trenton Lyke, August 8, 2019. -->
<html id = "ForumMenu">
<head>
<meta charset = "UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap Links -->

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
<link href="https://cdn.jsdelivr.net/npm/froala-editor@3.0.0-beta.1/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js" ></script>
 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/froala-editor@3.0.0-beta.1/js/froala_editor.pkgd.min.js"></script>
<link href="https://raw.githack.com/ttskch/select2-bootstrap4-theme/master/dist/select2-bootstrap4.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/css/select2.min.css" rel="stylesheet" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/r-2.2.2/datatables.min.css"/>
 
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/r-2.2.2/datatables.min.js"></script>






<!--My Stuff-->
<link rel = "stylesheet" href = "styles.css"/>


<title>Octagon Robotics</title>
<link rel = "icon" href = "favicon.png" type = "image/jpg"/>
</head>
<body>
<nav class="navbar navbar-expand-md bg-dark navbar-dark">
  
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav ma">
      <li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin" href="/">Home</a>
    </li>
    <li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin " href="/3DPrinterOrderForm">3D Printing</a>
    </li>
    <li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin " href="/LindblomOrderForm">Machining</a>
    </li>
  
	<li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin " href="/ForumMenu">Forum</a>
    </li>
    <li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin " href="" data-toggle="modal" data-target="#signup">Sign Up</a>
    </li>
	<%if(username == ""){%>
    <li class="nav-item">
      <a style="color: #949DA0; display: inline-block; padding:1vmin;  " href="" data-toggle="modal" data-target="#login">Login</a>
    </li>  
	<%}else{%>
	<li class="nav-item">
	
      <a style="color: #949DA0; display: inline-block; padding:1vmin "><%=username%><a href="/logout" data-toggle="tooltip" data-placement="bottom" title="Logout"><i class="fa fa-sign-out navColor"  aria-hidden="true"></i></a></a>
    </li> 
	<%}%>
    </ul>
  </div>  
</nav>
<!-- The Modal -->
  <div class="modal fade" id="login">
    <div class="modal-dialog modal-dialog-centered ">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Login <%if(uop == "n"){%>
			 <span style="color: red"><%="*Incorrect username or password"%></span>
			<%}%></h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <form action="/loginForum?page=ForumTopic&id=<%=topic.id%>" id="loginForm" method="POST">
        <!-- Modal body -->
        <div class="modal-body">
          
		  <div class="form-group">
			
			<label for="username">Username:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-user"></i></span>
			</div>
				<input type="text" name="username" class="form-control" id="usernameli" required>
				
				
			</div>
		  </div>
		  <div class="form-group">
			<label for="password">Password:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-lock"></i></span>
			</div>
			<input type="password" name="password" class="form-control"  id="passwordli" required>
			</div>
		  </div>
		  
		  
		
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
		<button type="submit" class="btn btn-primary">Submit</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="signup">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Sign Up</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <form action="/signup" enctype="multipart/form-data" method="POST">
        <!-- Modal body -->
        <div class="modal-body">
          
		  <div class="form-group">
			<label for="first_name">First Name:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-user"></i></span>
			</div>
				<input type="text" name="first_name" class="form-control" id="first_name" required>
			</div>
		  </div>
		  <div class="form-group">
			<label for="last_name">Last Name:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-user"></i></span>
			</div>
				<input type="text" name="last_name" class="form-control" id="last_name" required>
			</div>
		  </div>
		  <div class="form-group">
		  
			<label for="email">Email: <span style="color: red;" id="emailValidity"></span></label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-at"></i></span>
			</div>
				<input type="email" onchange="validateSignup()" name="email" class="form-control" id="email" required>
				
			</div>
		  </div>
		  <div class="form-group">
			<label for="team_name">Team Name:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-steam"></i></span>
			</div>
				<input type="text" name="team_name" class="form-control" id="team_name" required>
			</div>
		  </div>
		  <div class="form-group">
			<label for="team_number">Team Number:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-hashtag"></i></span>
			</div>
				<input type="text" name="team_number" class="form-control" id="team_number" required>
			</div>
		  </div>
		  
		  <div class="form-group">
		  
			<label for="username">Username:  <span style="color: red;" id="usernameValidity"></span></label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-user-plus"></i></span>
			</div>
				<input type="text" onchange="validateSignup()" name="username" class="form-control" id="username" required>
			</div>
		  </div>
		  <div class="form-group">
		  
		  
			<label for="password">Password:
			 <span style="color: red;" id="passwordValidity"></span>
			</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-lock"></i></span>
			</div>
			<input type="password" onchange="check(); validateSignup()" pattern="(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$" title="Your password must be 8 characters long and contain an uppercase letter, a lowercase letter, and a number/special character."  name="password" class="form-control"  id="password" required>
			</div>
		  </div>
		  <div class="form-group">
			<label for="password">Confirm Password:</label>
			<div class="input-group mb-3">
			<div class="input-group-prepend">
			  <span class="input-group-text"><i class="fa fa-lock"></i></span>
			</div>
			<input type="password" name="confirmPassword" class="form-control" pattern="(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$" title="Your password must be 8 characters long and contain an uppercase letter, a lowercase letter, and a number/special character." onchange="check()" id="confirmPassword"  required>
			</div>
		  </div>
		  
		  <div class="custom-file">
    <input type="file" class="custom-file-input" type="file" name="profile_picture" id="design_file" accept=".jpg,.png,.gif,.jpeg,.svg" required>
    <label class="custom-file-label" for="design_file">Profile Picture</label>
  </div>
		  
		
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
		<button type="submit" id="submitSignUp" class="btn btn-primary" disabled>Submit</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
		  
        </div>
        </form>
      </div>
    </div>
  </div>
<script>
// Add the following code if you want the name of the file appear on select
$(".custom-file-input").on("change", function() {
  var fileName = $(this).val().split("\\").pop();
  $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
});
$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip(); 
});

function check() {
	console.log($("#confirmPassword").val() != $('#password').val())
	if ($("#confirmPassword").val() != $('#password').val()) {
		document.getElementById("password").setCustomValidity('Password Must be Matching.');
		document.getElementById("confirmPassword").setCustomValidity('Password Must be Matching.');
	} else {
		// input is valid -- reset the error message
		document.getElementById("password").setCustomValidity('');
		document.getElementById("confirmPassword").setCustomValidity('');
	}
}

<%if(uop == "n"){%>$(alert("That login was invalid"))<%}%>

function validateSignup(){
$.ajax({url: "/validateSignup",type: "POST", data: {username: $("#username").val(), email: $("#email").val(), password: $("#password").val()}, success: function(validity){
    if($("#username").val().trim() != "" && !validity.username){
		$("#username").addClass("invalid");
		$("#usernameValidity").html("*Username was already taken.")
	}
	else{
		$("#username").removeClass("invalid");
		$("#usernameValidity").html("")
	}
	if($("#email").val().trim() != "" && !validity.email){
		$("#email").addClass("invalid");
		$("#emailValidity").html("*Email was already taken.")
	}
	else{
		$("#email").removeClass("invalid");
		$("#emailValidity").html("")
	}
	if($("#password").val().trim() != "" && !validity.password){
		$("#password").addClass("invalid");
		$("#passwordValidity").html("*Password was already taken.")
	}
	else{
		$("#password").removeClass("invalid");
		$("#passwordValidity").html("")
	}
	
	if(validity.username && $("#username").val().trim() != "" && validity.password && $("#password").val().trim() != "" && validity.email && $("#email").val().trim() != ""){
		$('#submitSignUp').prop("disabled", false);
	}
	else{
		$('#submitSignUp').prop("disabled", true);
	}
  }});
}
</script>



<div class="container text-center forumContainer" >
<h2 class="forumTopicHeader"><%=topic.name%></h2>
<h2 class="fs5"><%=topic.description%></h2>	
	
            
					<%
					var postCount = 0;
					posts.forEach(function(post){%>
					
						<div class="row">
							<div class="col-md-2"><img src="<%=post.profile_picture%>" class="forumPic img-thumbnail"></div>
							
							<div class="col-md-8">
							<br>
							<br>
							<div class="talk-bubble tri-right left-top">
						  <div class="talktext text-left">
						  <br/>
							<h4 class="forumUsername"><%=post.username%></h4>
							<pre><%=post.post_date%></pre>
							<div id="post<%=postCount%>"></div>
							<%-post.content%>
						  </div>
						</div>
						</div>
						
						</div>
						
						
					 <%})	%>
				
            
		
	</div>
	<form method="post"  action="/addPost?id=<%=id%>">
	<div class="container">
	<div class="row">
	<div class="col-md-12 text-left">
	<h3>Add something to the conversation</h3>
	<textarea name="content" id="myEditor" required></textarea>
	</div>
	</div>
	<div class="row row justify-content-end">
	<div class="col-md-1">
	<input type="submit" class="btn btn-info">
	</div>
	
	<div class="col-md-1">
	<input type="reset" class="btn btn-secondary">
	</div>
	
	</div>
	
  
</form>



<script>
  new FroalaEditor('#myEditor', {
    // Set the file upload URL.
    fileUploadURL: '/file_upload',
	fileUploadParams: {
        id: 'my_editor'
      },
	imageUploadURL: '/image_upload',
      imageUploadParams: {
        id: 'my_editor'
      },
	  videoUploadURL: '/video_upload',
      videoUploadParams: {
        id: 'my_editor'
      }
  })
  
  
</script>
</div>
  </div>
  <div id = "footer" class = "container-fluid  d-flex flex-column bg-dark">
	<div class = "col-md-3">
		<img class = "logo img-fluid mx-auto d-block" src = "OctagonRoboticsLogo.png" alt = "header"/>
	</div>
</div>
</body>
<script>
$(document).ready(function() {
    $('#example').DataTable({
		responsive: true
	});
} );



$($(document).ready(function() {
    $('.select2').select2({
		theme: 'bootstrap4',
	});
}));

function myFunc(){
alert('This may take a while. ')
}
$( function() {
    $( "#tabs" ).tabs();
  } );
  
  
</script>

</html>
